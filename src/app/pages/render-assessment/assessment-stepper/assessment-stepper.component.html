<div class="d-flex flex-column h-100">
  <nl-assessment-header></nl-assessment-header>
  <div class="container-fluid col">
    <div class="row flex-column h-100">
      <div class="col overflow-y-auto">
        <ng-container *ngIf="showInstructions">
          <div class="row flex-column gy-2 h-100">
            <div class="col">
              <iframe [src]="instructionsUrl" frameborder="0" width="100%" height="100%"></iframe>
            </div>
            <button class="col-auto mx-auto p-button" (click)="onInstructionsSubmit()">Next</button>
          </div>
        </ng-container>
        <ng-container *ngIf="showStepper">
          <div class="row gy-4 h-100">
            <div class="col-lg-9">
              <div class="row mt-4 justify-content-center">
                <nl-stepper [selectedIndex]="activeStepIndex">
                  <nl-step
                    *ngFor="let step of steps"
                    [completed]="step.completed"
                    [stepControl]="step.stepControl"
                    [title]="step.title"
                    [subTitle]="step.subTitle">
                    <ng-container *ngIf="step.stepControl && step.stepControl.get('assessmentId')">
                      <!-- Added above ngIf as instruction page don't have any formGroup controls-->
                      <form [formGroup]="step.stepControl">
                        <ng-container
                          formArrayName="itemAspectsFormArray"
                          *ngFor="
                            let itemAspect of sections[activeSectionIndex].itemAspects;
                            index as itemAspectIndex
                          ">
                          <div
                            class="assessment-section d-flex justify-content-center align-items-baseline gap-2 mt-4"
                            *ngIf="itemAspectIndex === activeQuestionIndex"
                            [formGroupName]="itemAspectIndex">
                            <div
                              class="question-number col-auto d-flex justify-content-center align-items-center">
                              {{ itemAspectIndex + 1 }}
                            </div>
                            <div class="question-section d-flex flex-column gap-4">
                              <div class="question border border-1 p-2 shadow">
                                <ng-container
                                  *ngIf="
                                    itemAspect.questionImage &&
                                      itemAspect.questionImage[selectedLanguage];
                                    else questionTpl
                                  ">
                                  <img
                                    [src]="itemAspect.questionImage[selectedLanguage]"
                                    alt="question-img"
                                    width="100%"
                                    height="100%" />
                                </ng-container>
                                <ng-template #questionTpl>
                                  {{ itemAspect.language[selectedLanguage].split('. ')[1] }}
                                </ng-template>
                              </div>
                              <div class="answer row g-2 justify-content-around">
                                <ng-container
                                  *ngFor="
                                    let answer of itemAspect.answerOptions;
                                    index as ansIndex
                                  ">
                                  <div class="col-auto">
                                    <div class="form-check">
                                      <input
                                        formControlName="selectedOption"
                                        (change)="onAnswerSelection()"
                                        class="form-check-input"
                                        type="radio"
                                        [value]="answer.choice"
                                        [id]="'ans-' + activeQuestionIndex + '-' + ansIndex" />
                                      <label
                                        class="form-check-label"
                                        [for]="'ans-' + activeQuestionIndex + '-' + ansIndex"
                                        >{{ answer.language[selectedLanguage] }}</label
                                      >
                                    </div>
                                  </div>
                                </ng-container>
                              </div>
                              <div class="d-flex gap-3 justify-content-center">
                                <button
                                  type="button"
                                  class="p-button p-button-secondary gap-2"
                                  [disabled]="activeQuestionIndex === 0">
                                  <i class="nl-icon left-arrow"></i>
                                  Back
                                </button>
                                <button type="button" class="p-button p-button-warning gap-2">
                                  Skip for Later
                                  <i class="nl-icon right-arrow"></i>
                                </button>
                              </div>
                            </div>
                          </div>
                        </ng-container>
                      </form>
                    </ng-container>
                  </nl-step>
                </nl-stepper>
              </div>
            </div>
            <div class="col-lg-3 h-100 assessment-timer-section">
              <div class="row flex-lg-column">
                <div class="col">
                  <div
                    class="progress-timer d-inline-flex justify-content-center align-items-center"></div>
                </div>
                <div class="sub-test-section col"></div>
              </div>
            </div>
          </div>
        </ng-container>
      </div>
    </div>
  </div>
</div>
